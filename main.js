import { Telegraf } from 'telegraf'

// –¢–æ–∫–µ–Ω —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞
const bot = new Telegraf('6720826721:AAGca7w3fW-wKK9-yAOa4h2aaPaccQhAOcw')

// ID –∫–∞–Ω–∞–ª–∞ (–∏–ª–∏ –≥—Ä—É–ø–ø—ã)
const targetChatId = '-1002206913679'
const OWNER_ID = '7282627530'

// –ú–∞—Å—Å–∏–≤ —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ —Ñ—Ä–∞–∑–∞–º–∏
const randomPhrases = [
    '—Ç—ã —à–æ –≥–æ–ª–æ–≤–∞ —Ç—É–±–∞–∑–∏—Ç–æ–≤–∞—è, —Å–¥—É—Ä—ç–ª–∞',
    '–∑–∞–Ω—è—Ç, –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–∏—à—É —ç—Ç–æ–º—É... –∫–∞–∫ –µ–≥–æ.. –Ω—É —Ç—ã –ø–æ–Ω—è–ª',
    '–Ω–∞ –¥–∞–ª—å–Ω–µ–º –±—É–¥–µ–º',
    '–Ω–µ—Å—É –≤ –∑—É–±–∞—Ö',
    '—â–∞—Å, —Ç–æ–ª—å–∫–æ –ø–∞–ª–µ—Ü –∏–∑ —Ä–æ–∑–µ—Ç–∫–∏ –≤—ã—Ç–∞—â—É',
    '–≤—Å—ë –≤ –Ω–æ—Ä–º–µ, –ø–æ –∫—É—Ä—Å—É –ª–µ—Ç–∏–º',
    '–∏–¥–∏, –ø–æ—Ü–µ–ª—É–π –±–µ–ª–∫—É –≤ –ª–æ–±',
    '—è —Ç—É—Ç —É–º–æ–º —Ç—Ä–æ–Ω—É–ª—Å—è, –Ω–æ –Ω–µ–Ω–∞–¥–æ–ª–≥–æ',
    '–∑–∞–≥—Ä—É–∂–∞—é –º–æ–∑–≥–∏, –ø–æ–¥–æ–∂–¥–∏',
    '–Ω–µ –º–µ—à–∞–π, —è –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π',
    '—É –º–µ–Ω—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é "–Ω–∏—á–µ–≥–æ–Ω–µ–¥–µ–ª–∞–Ω–∏–µ"',
    '–æ—Ç –≤–∏–Ω—Ç–∞!',
    '–Ω–µ –¥—ë—Ä–≥–∞–π —Ç–∏–≥—Ä–∞ –∑–∞ —É—Å—ã',
    '–¥–∞–≤–∞–π —è —Ç–µ–±–µ –ª—É—á—à–µ –∞–Ω–µ–∫–¥–æ—Ç —Ä–∞—Å—Å–∫–∞–∂—É',
    '—É –º–µ–Ω—è –ª–∞–ø–∫–∏',
    '—Å–ª—ã—à—å, —Ç—ã, –±–æ—Ä–æ–¥–∞ –∏–∑ –≤–∞—Ç—ã',
    '–Ω–µ –≥—Ä—É–∑–∏ –º–µ–Ω—è, —è –Ω–µ –ö–∞–º–ê–ó',
    '–º—ã—Å–ª–∏ —É–ª–µ—Ç–µ–ª–∏ –Ω–∞ —é–≥–∞',
    '–∞ —É —Ç–µ–±—è —á—Ç–æ, —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å —Å—É—Ä–∫–∞?',
    '—è –≤ —Ç–∞–Ω–∫–µ',
    '—Å–∞–º —Å–µ–±–µ –Ω–∞ —É–º–µ',
    '–æ—Ç—Å—Ç–∞–Ω—å –æ—Ç –º–µ–Ω—è, —è –≤ –ø–µ—á–∞–ª–∏',
    '–ø–µ—Ä–µ–∑–≤–æ–Ω–∏ –º–Ω–µ, —è –Ω–µ –≤ —Ä–µ—Å—É—Ä—Å–µ',
    '–≤—Å—ë –±—É–¥–µ—Ç –≤ –ª—É—á—à–µ–º –≤–∏–¥–µ',
    '—è —Ç—É—Ç –º–∏–º–æ –ø—Ä–æ—Ö–æ–¥–∏–ª',
    '—á—Ç–æ-—Ç–æ –º–Ω–µ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –ø—Ä–æ–≤–∞–ª',
    '–Ω—É, —à–æ —Ç–∞–º, –∫–∞–∫ –¥–µ–ª–∞?',
    '—è –µ—â—ë –Ω–µ –ø—Ä–æ—Å–Ω—É–ª—Å—è',
    '—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º–æ–π —Ç—Ä—É–ø',
    '—è –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω, –Ω–æ –º–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ'
];

const randomPhrasesAndr = [
   '–ê–Ω–¥—Ä–µ–π —Ç–æ –ø—Ä–∏–∫–æ–ª–∏—Å—Ç',
    '–∏–¥–∏ —Å–æ —Å–≤–æ–∏–º –ê–Ω–¥—Ä–µ–µ–º –æ—Ç—Å–µ–¥–æ–≤–∞',
    '–¢—ã —à–æ –ø—Ä–æ–≤–µ—Ä—è–µ—à—å—Å—è???',
]

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è ID —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Å—Å—ã–ª–∫–∏
function extractMessageId(text) {
    // –ò—â–µ–º —Å—Å—ã–ª–∫–∏ –≤–∏–¥–∞ t.me/c/1002206913679/123 –∏–ª–∏ https://t.me/c/1002206913679/123
    const linkRegex = /(?:https?:\/\/)?t\.me\/c\/\d+\/(\d+)/
    const match = text.match(linkRegex)
    return match ? parseInt(match[1]) : null
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', async (ctx) => {
    console.log('=== –ù–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï ===')
    console.log('–¢–∏–ø —á–∞—Ç–∞:', ctx.chat.type)
    console.log('ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è:', ctx.from.id)
    console.log('–¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è:', Object.keys(ctx.message)[1])
    console.log('=====================')

    const messageText = ctx.message.text ? ctx.message.text.toLowerCase() : ''
    const isOwner = ctx.from.id.toString() === OWNER_ID
    const isPrivateChat = ctx.chat.type === 'private'

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –ª—é–±–æ–º —Ç–∏–ø–µ —á–∞—Ç–∞
    if (messageText.toLowerCase().includes('—Ç–∞–ø–∫–∏') || messageText.toLowerCase().includes('—Ç–∞–ø–æ—á–∫–∏')) {
        console.log('‚ùå –ù–∞–π–¥–µ–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ. –û—Ç–ø—Ä–∞–≤–ª—è—é —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É.')

        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É –∏–∑ –º–∞—Å—Å–∏–≤–∞
        const randomPhrase = randomPhrases[Math.floor(Math.random() * randomPhrases.length)]

        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ñ—Ä–∞–∑–æ–π –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç
            await ctx.reply(randomPhrase)
            console.log('‚úÖ –°–ª—É—á–∞–π–Ω–∞—è —Ñ—Ä–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!')
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–ª—É—á–∞–π–Ω–æ–π —Ñ—Ä–∞–∑—ã:', error)
        }
    }

    if (messageText.toLowerCase().includes('–∞–Ω–¥—Ä–µ–π')) {
        console.log('‚ùå –ù–∞–π–¥–µ–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ. –û—Ç–ø—Ä–∞–≤–ª—è—é —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É.')

        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É –∏–∑ –º–∞—Å—Å–∏–≤–∞
        const randomPhrase = randomPhrasesAndr[Math.floor(Math.random() * randomPhrasesAndr.length)]

        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ñ—Ä–∞–∑–æ–π –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç
            await ctx.reply(randomPhrase)
            console.log('‚úÖ –°–ª—É—á–∞–π–Ω–∞—è —Ñ—Ä–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!')
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–ª—É—á–∞–π–Ω–æ–π —Ñ—Ä–∞–∑—ã:', error)
        }
    }

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≤ –ª–∏—á–∫–µ, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ
    if (isPrivateChat && isOwner) {
        console.log('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≤ –ª–∏—á–∫–µ')

        const userMessageText = ctx.message.caption || ctx.message.text

        const messageId = userMessageText ? extractMessageId(userMessageText) : null

        if (messageId) {
            console.log(`üîó –ù–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ ID: ${messageId}`)

            const replyText = userMessageText.replace(/(?:https?:\/\/)?t\.me\/c\/\d+\/\d+/g, '').trim()

            if (replyText) {
                try {
                    await ctx.telegram.sendMessage(targetChatId, replyText, {
                        reply_to_message_id: messageId
                    })
                    await ctx.reply('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')
                    console.log('‚úÖ –û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!')
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞:', error)
                    await ctx.reply('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞!')
                }
            } else {
                try {
                    await ctx.telegram.copyMessage(targetChatId, ctx.chat.id, ctx.message.message_id, {
                        reply_to_message_id: messageId
                    })
                    await ctx.reply('‚úÖ –ú–µ–¥–∏–∞—Ñ–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª –∫–∞–∫ –æ—Ç–≤–µ—Ç!')
                    console.log('‚úÖ –ú–µ–¥–∏–∞—Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!')
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—ã–ª–∫–µ –º–µ–¥–∏–∞:', error)
                    await ctx.reply('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—ã–ª–∫–µ –º–µ–¥–∏–∞!')
                }
            }
        } else {
            console.log('üìù –û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Å—Å—ã–ª–∫–∏')

            try {
                await ctx.telegram.copyMessage(targetChatId, ctx.chat.id, ctx.message.message_id)
                await ctx.reply('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–Ω–∞–ª!')
                console.log('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!')
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error)
                await ctx.reply('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!')
            }
        }
    } else if (!isPrivateChat && !messageText.includes('—Ç–∞–ø–∫–∏') && !messageText.includes('—Ç–∞–ø–æ—á–∫–∏')) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        console.log('‚ùå –ù–µ –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏–ª–∏ –Ω–µ –≤ –ª–∏—á–∫–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É—é')
    }
})

bot.launch()

console.log('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!')